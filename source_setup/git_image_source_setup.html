<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Git Image Source Setup &mdash; Cloud Builder 0.2.22 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Kafka Message Broker Setup" href="../kafka_broker_setup.html" />
    <link rel="prev" title="Git Package Source Setup" href="git_package_source_setup.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Cloud Builder
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../infrastructure_setup.html">Infrastructure Setup</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../source_setup.html">Cloud Builder Source Setup</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="git_package_source_setup.html">Git Package Source Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="git_package_source_setup.html#understanding-the-project-structure">Understanding the project structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="git_package_source_setup.html#understanding-cb-cloud-builder-yml">Understanding <code class="file docutils literal notranslate"><span class="pre">.cb/cloud_builder.yml</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="git_package_source_setup.html#understanding-cb-build-root-kiwi">Understanding <code class="file docutils literal notranslate"><span class="pre">.cb/build_root.kiwi</span></code></a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Git Image Source Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#understanding-the-project-structure">Understanding the project structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#understanding-cb-cloud-builder-yml">Understanding <code class="file docutils literal notranslate"><span class="pre">.cb/cloud_builder.yml</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../kafka_broker_setup.html">Kafka Message Broker Setup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../kafka_broker_setup.html#create-and-install-the-control-plane">Create and Install the Control Plane</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kafka_broker_setup.html#control-plane-setup">Control Plane Setup</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../runner_setup.html">Runner Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../request_package_build.html">Request a Package Build</a></li>
<li class="toctree-l1"><a class="reference internal" href="../auto_rebuild_on_source_change.html">Auto Rebuild on Package Source Change</a></li>
<li class="toctree-l1"><a class="reference internal" href="../auto_rebuild_on_build_dependencies.html">Auto Rebuild on Package Build Dependency Changes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../collect_and_build_project_repos.html">Collect and Build Project Repos</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../collect_and_build_project_repos.html#create-and-setup-the-reposerver-instance">Create and Setup the reposerver instance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../collect_and_build_project_repos.html#setup-apache-to-serve-the-repos">Setup Apache to Serve the Repos</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../commands.html">Overview Cloud Builder Services</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../commands/cb_fetch.html">cb-fetch</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../commands/cb_fetch.html#synopsis">SYNOPSIS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/cb_fetch.html#description">DESCRIPTION</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/cb_fetch.html#options">OPTIONS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../commands/cb_scheduler.html">cb-scheduler</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../commands/cb_scheduler.html#synopsis">SYNOPSIS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/cb_scheduler.html#description">DESCRIPTION</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../commands/cb_scheduler.html#building-a-package">Building a package:</a></li>
<li class="toctree-l4"><a class="reference internal" href="../commands/cb_scheduler.html#build-an-os-image">Build an OS image:</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../commands/cb_scheduler.html#options">OPTIONS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../commands/cb_prepare.html">cb-prepare</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../commands/cb_prepare.html#synopsis">SYNOPSIS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/cb_prepare.html#description">DESCRIPTION</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/cb_prepare.html#options">OPTIONS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../commands/cb_run.html">cb-run</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../commands/cb_run.html#synopsis">SYNOPSIS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/cb_run.html#description">DESCRIPTION</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/cb_run.html#options">OPTIONS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../commands/cb_image.html">cb-image</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../commands/cb_image.html#synopsis">SYNOPSIS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/cb_image.html#description">DESCRIPTION</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/cb_image.html#options">OPTIONS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../commands/cb_info.html">cb-info</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../commands/cb_info.html#synopsis">SYNOPSIS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/cb_info.html#description">DESCRIPTION</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/cb_info.html#options">OPTIONS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../commands/cb_depsolver.html">cb-depsolver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../commands/cb_collect.html">cb-collect</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../commands/cb_collect.html#synopsis">SYNOPSIS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/cb_collect.html#description">DESCRIPTION</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/cb_collect.html#options">OPTIONS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../commands/cb_ctl.html">cb-ctl</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../commands/cb_ctl.html#synopsis">SYNOPSIS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/cb_ctl.html#description">DESCRIPTION</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/cb_ctl.html#options">OPTIONS</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Cloud Builder</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../source_setup.html">Cloud Builder Source Setup</a> &raquo;</li>
      <li>Git Image Source Setup</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/source_setup/git_image_source_setup.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="git-image-source-setup">
<span id="id1"></span><h1>Git Image Source Setup<a class="headerlink" href="#git-image-source-setup" title="Permalink to this headline">¶</a></h1>
<p>Cloud Builder reads any information about a KIWI image and its metadata
from a specified git repository. This includes the following
types of information:</p>
<dl class="simple">
<dt>The image configuration files:</dt><dd><p>These are all files to build a KIWI image. For details
see: <a class="reference external" href="https://osinside.github.io/kiwi/overview.html">https://osinside.github.io/kiwi/overview.html</a></p>
</dd>
<dt>The <code class="file docutils literal notranslate"><span class="pre">.cb/cloud_builder.yml</span></code> project file:</dt><dd><p>This file contains information for Cloud Builder to know how
the image should be build. It also contains information about
the runner group that is eligible to pick up the build request.</p>
</dd>
</dl>
<p>Before creating the git repository, let’s clone the
example <strong>cloud-builder-packages</strong> git repo from here:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git clone https://github.com/OSInside/cloud-builder-packages.git
</pre></div>
</div>
<section id="understanding-the-project-structure">
<h2>Understanding the project structure<a class="headerlink" href="#understanding-the-project-structure" title="Permalink to this headline">¶</a></h2>
<p>By convention the Cloud Builder package sources need to follow a
certain files/directory structure which is provided in the
reference <code class="xref py py-obj docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span></code> from above. In general the project structure
is aligned to the following layout:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>projects
├── ...
│
├── PROJECT_A
│   └── SUB_PROJECT
│       └── ...
│
└── images
    └── leap
        └── test-image-disk
            ├── .cb
            │    └── cloud_builder.yml
            ├── appliance.kiwi
            └── config.sh
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It’s important that all projects are stored below a
directory called <code class="docutils literal notranslate"><span class="pre">projects</span></code>. This is the only convention
Cloud Builder expects to be respected. Below <code class="docutils literal notranslate"><span class="pre">projects</span></code> any custom
structure to store projects and image sources is allowed</p>
</div>
</section>
<section id="understanding-cb-cloud-builder-yml">
<h2>Understanding <code class="file docutils literal notranslate"><span class="pre">.cb/cloud_builder.yml</span></code><a class="headerlink" href="#understanding-cb-cloud-builder-yml" title="Permalink to this headline">¶</a></h2>
<p>In general <code class="file docutils literal notranslate"><span class="pre">.cb/cloud_builder.yml</span></code> contains information about
how the image target should be build. A typical file looks like the
following:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">schema_version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.1</span>
<span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">test-image-disk</span>

<span class="nt">images</span><span class="p">:</span>
  <span class="p p-Indicator">-</span>
    <span class="nt">arch</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">x86_64</span>
    <span class="nt">runner_group</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">suse</span>
    <span class="nt">selection</span><span class="p">:</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">standard</span>
      <span class="nt">profiles</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">A</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">B</span>
      <span class="nt">build_arguments</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="s">&quot;--clear-cache&quot;</span>
</pre></div>
</div>
<dl>
<dt><code class="xref py py-obj docutils literal notranslate"><span class="pre">schema_version</span></code>:</dt><dd><p>Cloud Builder validates any information send through the message broker and
read by services via a Cerberus validated schema. Every schema comes
with a version such that changes to the schema in the future becomes
possible.</p>
</dd>
<dt><code class="xref py py-obj docutils literal notranslate"><span class="pre">name</span></code>:</dt><dd><p>Specifies the name of the image project. It’s advisable to use
the same name as used in the KIWI image desription. When Cloud Builder
builds the image, the output filenames are the result of the KIWI
image build and not connected to the name used here.</p>
</dd>
<dt><code class="xref py py-obj docutils literal notranslate"><span class="pre">images</span></code>:</dt><dd><p>Contains the target information for images to build from the
KIWI image description. The settings here allows to build the
image with custom options, e.g for different profiles, call
options or architectures.</p>
<ul>
<li><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">arch</span></code>:</p>
<p>An architecture name. The name must match one of the
names known to Python’s <code class="xref py py-obj docutils literal notranslate"><span class="pre">platform.machine()</span></code> names.</p>
</li>
<li><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">runner_group</span></code>:</p>
<p>The runner group specifies a name that matches with the runner_group
setup on the runner instance. A request to build the image will
only be taken by runners of that group. That way an image for
e.g a specific architecture can be connected to a runner which is
of that architecture.</p>
</li>
<li><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">selection</span></code>:</p>
<p>The selection is a name for a collection of KIWI build parameters
and provides a namespace to group this information.</p>
<ul>
<li><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">name</span></code>:</p>
<p>Name of the selection</p>
</li>
<li><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">profiles</span></code>:</p>
<p>List of KIWI profile names to use for building the image</p>
</li>
<li><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">build_arguments</span></code>:</p>
<p>List of KIWI caller arguments to pass in addition to the
ones set by default</p>
</li>
</ul>
</li>
</ul>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>With the explanation on the git contents based on the
example <code class="xref py py-obj docutils literal notranslate"><span class="pre">cloud-builder-packages</span></code> repo, the next step
could be to create the project specific git repo and
place the desired image and metadata source files.
It would also be possible to continue with the example
git repo and move to the real sources later.</p>
</div>
<p>Learn how to setup the message broker service
<a class="reference internal" href="../kafka_broker_setup.html#kafka-broker-setup"><span class="std std-ref">Kafka Message Broker Setup</span></a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="git_package_source_setup.html" class="btn btn-neutral float-left" title="Git Package Source Setup" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../kafka_broker_setup.html" class="btn btn-neutral float-right" title="Kafka Message Broker Setup" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Marcus Schäfer.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>