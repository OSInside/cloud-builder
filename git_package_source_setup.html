

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Git Package Source Setup &mdash; Cloud Builder 0.1.11 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Cloud Builder Services" href="commands.html" />
    <link rel="prev" title="Infrastructure Setup" href="infrastructure_setup.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Cloud Builder
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="infrastructure_setup.html">Infrastructure Setup</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Git Package Source Setup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#understanding-the-project-structure">Understanding the project structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="#understanding-cloud-builder-yml">Understanding <code class="file docutils literal notranslate"><span class="pre">cloud_builder.yml</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#understanding-cloud-builder-kiwi">Understanding <code class="file docutils literal notranslate"><span class="pre">cloud_builder.kiwi</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="commands.html">Cloud Builder Services</a><ul>
<li class="toctree-l2"><a class="reference internal" href="commands/cb_fetch.html">cb-fetch</a></li>
<li class="toctree-l2"><a class="reference internal" href="commands/cb_scheduler.html">cb-scheduler</a></li>
<li class="toctree-l2"><a class="reference internal" href="commands/cb_prepare.html">cb-prepare</a></li>
<li class="toctree-l2"><a class="reference internal" href="commands/cb_run.html">cb-run</a></li>
<li class="toctree-l2"><a class="reference internal" href="commands/cb_info.html">cb-info</a></li>
<li class="toctree-l2"><a class="reference internal" href="commands/cb_ctl.html">cb-ctl</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Cloud Builder</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Git Package Source Setup</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/git_package_source_setup.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="git-package-source-setup">
<span id="id1"></span><h1>Git Package Source Setup<a class="headerlink" href="#git-package-source-setup" title="Permalink to this headline">¶</a></h1>
<p>Cloud Builder reads any information about a package from a given
git repository. This includes the following types of
information:</p>
<dl>
<dt>The package configuration files:</dt><dd><p>These are files like the software source tarball, the
.spec file for rpm packages or any other sort of setup
file needed to build a package for the desired package
manager.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This documentation will not cover the package setup
for the various package managers and expects the data
to build a package to be present and in understanding
by the author.</p>
</div>
</dd>
<dt>The <code class="file docutils literal notranslate"><span class="pre">cloud_builder.yml</span></code> project file:</dt><dd><p>This file contains information for Cloud Builder to know for which
distribution and architecture the package should be build.
It also contains information about the runner group that
is eligible to pick up the build request.</p>
</dd>
<dt>The <code class="file docutils literal notranslate"><span class="pre">cloud_builder.kiwi</span></code> metadata file:</dt><dd><p>This file contains instructions how to build the buildroot
environment within the package should be build. The buildroot
is created using <a class="reference external" href="https://osinside.github.io/kiwi">KIWI</a></p>
</dd>
</dl>
<p>To setup the git repository I suggest to start with the
example <strong>cloud-builder-packages</strong> git repo from here:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git clone https://github.com/OSInside/cloud-builder-packages.git
</pre></div>
</div>
<div class="section" id="understanding-the-project-structure">
<h2>Understanding the project structure<a class="headerlink" href="#understanding-the-project-structure" title="Permalink to this headline">¶</a></h2>
<p>By convention the Cloud Builder package sources has to follow the structure
you see in the git checkout. This means in general:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>projects
├── ...
│
├── PROJECT_A
│   └── SUB_PROJECT
│       └── ...
│
└── PROJECT_B
    └── PACKAGE
        ├── cloud_builder.kiwi
        ├── cloud_builder.yml
        └── PACKAGE.source_files...
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In your own git you need to make sure that all projects
are stored below a directory called <code class="docutils literal notranslate"><span class="pre">projects</span></code>. This is
the only convention Cloud Builder expects to be respected. Below
<code class="docutils literal notranslate"><span class="pre">projects</span></code> you can freely choose the structure to store
package sources</p>
</div>
</div>
<div class="section" id="understanding-cloud-builder-yml">
<h2>Understanding <code class="file docutils literal notranslate"><span class="pre">cloud_builder.yml</span></code><a class="headerlink" href="#understanding-cloud-builder-yml" title="Permalink to this headline">¶</a></h2>
<p>In general the <code class="file docutils literal notranslate"><span class="pre">cloud_builder.yml</span></code> contains information about
the target distribution for which the package should be build.
A typical file looks like the following:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">schema_version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.1</span>
<span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python-kiwi_boxed_plugin</span>

<span class="nt">distributions</span><span class="p">:</span>
  <span class="p p-Indicator">-</span>
    <span class="nt">dist</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">TW</span>
    <span class="nt">arch</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">x86_64</span>
    <span class="nt">runner_group</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">suse</span>

  <span class="p p-Indicator">-</span>
    <span class="nt">dist</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Fedora34</span>
    <span class="nt">arch</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">x86_64</span>
    <span class="nt">runner_group</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fedora</span>
</pre></div>
</div>
<dl>
<dt>schema_version:</dt><dd><p>Cloud Builder validates any information send through the message broker and
read by services via a Cerberus validated schema. Every schema comes
with a version such that changes to the schema in the future becomes
possible.</p>
</dd>
<dt>name:</dt><dd><p>Specifies the name of the package to connect the project file with
the actual package. The name must match the name of the <strong>PACKAGE</strong>
source directory</p>
</dd>
<dt>distributions:</dt><dd><p>Contains the target distribution(s) for which the package should be
build</p>
<ul class="simple">
<li><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">dist</span></code>: A custom name to identify the distribution. It’s good
to choose a name which makes it easy to get an idea about the
target</p></li>
<li><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">arch</span></code>: An architecture name. The name must match one of the
names known to Python’s <code class="xref py py-obj docutils literal notranslate"><span class="pre">platform.machine()</span></code> names</p></li>
<li><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">runner_group</span></code>:
The runner group specifies a name that matches with the runner_group
setup on the runner instance. A request to build the package will
only be taken by runners of that group. That way a package for
e.g Fedora can be connected to a runner which is based on Fedora.
It’s possible to overcome incompatibilities between distributions
like the rpm database that way.</p></li>
</ul>
<p>The information for <code class="xref py py-obj docutils literal notranslate"><span class="pre">dist</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">arch</span></code> will be combined into a profile
name <code class="xref py py-obj docutils literal notranslate"><span class="pre">dist.arch</span></code>. In the above example this results into two profile
names:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>TW.x86_64
Fedora34.x86_64
</pre></div>
</div>
<p>These profile names plays a central role in the setup of the
following <code class="file docutils literal notranslate"><span class="pre">cloud_builder.kiwi</span></code> file</p>
</dd>
</dl>
</div>
<div class="section" id="understanding-cloud-builder-kiwi">
<h2>Understanding <code class="file docutils literal notranslate"><span class="pre">cloud_builder.kiwi</span></code><a class="headerlink" href="#understanding-cloud-builder-kiwi" title="Permalink to this headline">¶</a></h2>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="commands.html" class="btn btn-neutral float-right" title="Cloud Builder Services" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="infrastructure_setup.html" class="btn btn-neutral float-left" title="Infrastructure Setup" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Marcus Schäfer.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>